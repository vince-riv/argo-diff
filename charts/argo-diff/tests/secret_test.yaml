---
suite: secret tests
templates:
  - secret.yaml
tests:
  - it: no config - no data
    release:
      name: argo-diff
    template: secret.yaml
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: Secret
          name: argo-diff-env
      - notExists:
          path: data
  - it: secret annotations
    set:
      secret.annotations:
        is_unittest: "yes"
    asserts:
      - equal:
          path: metadata.annotations.is_unittest
          value: "yes"
  - it: config argocd.authToken
    set:
      config.argocd.authToken: testing
    asserts:
      - equal:
          path: data.ARGOCD_AUTH_TOKEN
          value: testing
          decodeBase64: true
  - it: config github.application.privateKey
    set:
      config.github.application.privateKey: testing
    asserts:
      - equal:
          path: data.GITHUB_APP_PRIVATE_KEY
          value: testing
          decodeBase64: true
  - it: config github.auth.token
    set:
      config.github.auth.token: testing
    asserts:
      - equal:
          path: data.GITHUB_TOKEN
          value: testing
          decodeBase64: true
  - it: config github.webhook.sharedSecret
    set:
      config.github.webhook.sharedSecret: testing
    asserts:
      - equal:
          path: data.GITHUB_WEBHOOK_SECRET
          value: testing
          decodeBase64: true
